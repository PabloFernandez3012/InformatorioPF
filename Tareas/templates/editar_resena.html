<!-- 
=============================================================================
TEMPLATE DE EDITAR RESEÃ‘A
=============================================================================
Esta pÃ¡gina permite a los usuarios editar sus propias reseÃ±as.
Solo el autor de la reseÃ±a puede acceder a esta pÃ¡gina.
-->

{% extends 'base.html' %} <!-- Hereda la estructura de base.html -->

<!-- TÃ­tulo especÃ­fico de esta pÃ¡gina -->
{% block title %}Editar ReseÃ±a - {{ juego.nombre }}{% endblock %}

<!-- Breadcrumb especÃ­fico -->
{% block breadcrumb %}
    ğŸ  <a href="{% url 'home' %}" style="color: #6c757d; text-decoration: none;">Inicio</a> 
    <span style="margin: 0 8px;">â€º</span> 
    ğŸ® <a href="{% url 'tareas' %}" style="color: #6c757d; text-decoration: none;">Juegos</a>
    <span style="margin: 0 8px;">â€º</span> 
    ğŸ¯ <a href="{% url 'detalle_juego' juego.id %}" style="color: #6c757d; text-decoration: none;">{{ juego.nombre }}</a>
    <span style="margin: 0 8px;">â€º</span> 
    <strong style="color: #007bff;">âœï¸ Editar ReseÃ±a</strong>
{% endblock %}

<!-- Inicia el bloque de contenido especÃ­fico de esta pÃ¡gina -->
{% block content %}

<!-- ===== ENCABEZADO CON INFORMACIÃ“N DEL JUEGO ===== -->
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; color: white; text-align: center;">
    <h1 style="margin: 0; font-size: 2.2em;">âœï¸ Editar tu ReseÃ±a</h1>
    <p style="margin: 10px 0 0 0; font-size: 1.3em; opacity: 0.9;">
        ğŸ“ Modifica tu opiniÃ³n sobre <strong>{{ juego.nombre }}</strong>
    </p>
</div>

<!-- ===== MOSTRAR MENSAJES (Ã©xito, error, etc.) ===== -->
{% if messages %}
    {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% else %}alert-info{% endif %}" 
             style="margin-bottom: 20px;">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<!-- ===== INFORMACIÃ“N DEL JUEGO ===== -->
<div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
        <div style="font-size: 3em;">ğŸ®</div>
        <div>
            <h2 style="margin: 0 0 8px 0; color: #343a40;">{{ juego.nombre }}</h2>
            <p style="margin: 0; color: #6c757d;">
                <strong>ğŸ¢ Estudio:</strong> {{ juego.estudio }}<br>
                <strong>ğŸ“… Fecha:</strong> {{ juego.fecha_publicacion|date:"d M Y" }}<br>
                <strong>ğŸ·ï¸ CategorÃ­as:</strong> {{ juego.categorias_texto }}
            </p>
        </div>
    </div>
    
    <!-- DescripciÃ³n del juego -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #007bff;">
        <h4 style="color: #495057; margin-bottom: 10px;">ğŸ“– DescripciÃ³n:</h4>
        <p style="color: #6c757d; margin: 0; line-height: 1.6;">{{ juego.descripcion }}</p>
    </div>
</div>

<!-- ===== FORMULARIO DE EDICIÃ“N DE RESEÃ‘A ===== -->
<div class="form-container">
    <h3 style="color: #343a40; margin-bottom: 25px; text-align: center;">
        âœï¸ Edita tu ReseÃ±a
    </h3>
    
    <form method="POST" style="max-width: none;">
        {% csrf_token %}
        
        <!-- ===== CAMPO DE PUNTUACIÃ“N ===== -->
        <div class="form-field">
            <label for="puntuacion">â­ PuntuaciÃ³n (1-5 estrellas):</label>
            <select name="puntuacion" id="puntuacion" required>
                <option value="">Selecciona una puntuaciÃ³n</option>
                <option value="1" {% if resena.puntuacion == 1 %}selected{% endif %}>â­ 1 - Muy malo</option>
                <option value="2" {% if resena.puntuacion == 2 %}selected{% endif %}>â­â­ 2 - Malo</option>
                <option value="3" {% if resena.puntuacion == 3 %}selected{% endif %}>â­â­â­ 3 - Regular</option>
                <option value="4" {% if resena.puntuacion == 4 %}selected{% endif %}>â­â­â­â­ 4 - Bueno</option>
                <option value="5" {% if resena.puntuacion == 5 %}selected{% endif %}>â­â­â­â­â­ 5 - Excelente</option>
            </select>
        </div>
        
        <!-- ===== CAMPO DE COMENTARIO ===== -->
        <div class="form-field">
            <label for="comentario">ğŸ’¬ Tu comentario actualizado:</label>
            <textarea name="comentario" 
                      id="comentario" 
                      rows="6" 
                      placeholder="Comparte tu experiencia actualizada con este juego..." 
                      required>{{ resena.comentario }}</textarea>
            <small style="color: #6c757d; font-size: 14px;">
                ğŸ’¡ Tip: Explica quÃ© cambiÃ³ en tu opiniÃ³n y por quÃ© actualizas tu reseÃ±a
            </small>
        </div>
        
        <!-- ===== BOTONES DE ACCIÃ“N ===== -->
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
            <button type="submit" class="btn btn-primary">
                âœ… Actualizar ReseÃ±a
            </button>
            <a href="{% url 'detalle_juego' juego.id %}" class="btn btn-secondary">
                âŒ Cancelar
            </a>
        </div>
    </form>
</div>

<!-- ===== INFORMACIÃ“N ADICIONAL ===== -->
<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px; text-align: center; border: 2px dashed #dee2e6;">
    <h4 style="color: #495057; margin-bottom: 15px;">â„¹ï¸ InformaciÃ³n Importante</h4>
    <p style="color: #6c757d; margin: 0; line-height: 1.6;">
        â€¢ Solo puedes editar tus propias reseÃ±as<br>
        â€¢ Los cambios se guardarÃ¡n inmediatamente<br>
        â€¢ Tu reseÃ±a actualizada serÃ¡ visible para todos los usuarios<br>
        â€¢ Puedes cambiar tanto la puntuaciÃ³n como el comentario
    </p>
</div>

<!-- ===== JAVASCRIPT PARA MEJORAR LA EXPERIENCIA ===== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ValidaciÃ³n del formulario antes de enviar
    const form = document.querySelector('form');
    const puntuacionSelect = document.getElementById('puntuacion');
    const comentarioTextarea = document.getElementById('comentario');
    
    form.addEventListener('submit', function(e) {
        let isValid = true;
        let errors = [];
        
        // Validar puntuaciÃ³n
        if (!puntuacionSelect.value) {
            errors.push('Debes seleccionar una puntuaciÃ³n');
            isValid = false;
        }
        
        // Validar comentario
        const comentario = comentarioTextarea.value.trim();
        if (comentario.length < 10) {
            errors.push('El comentario debe tener al menos 10 caracteres');
            isValid = false;
        }
        
        if (comentario.length > 1000) {
            errors.push('El comentario no puede exceder 1000 caracteres');
            isValid = false;
        }
        
        // Si hay errores, mostrarlos y prevenir envÃ­o
        if (!isValid) {
            e.preventDefault();
            alert('Por favor corrige los siguientes errores:\n\n' + errors.join('\n'));
        }
    });
    
    // Contador de caracteres para el comentario
    comentarioTextarea.addEventListener('input', function() {
        const length = this.value.length;
        const maxLength = 1000;
        const remaining = maxLength - length;
        
        // Crear o actualizar contador
        let counter = document.getElementById('char-counter');
        if (!counter) {
            counter = document.createElement('small');
            counter.id = 'char-counter';
            counter.style.display = 'block';
            counter.style.textAlign = 'right';
            counter.style.marginTop = '5px';
            this.parentNode.appendChild(counter);
        }
        
        counter.textContent = `${length}/${maxLength} caracteres`;
        counter.style.color = remaining < 50 ? '#dc3545' : '#6c757d';
    });
    
    // Trigger inicial del contador
    comentarioTextarea.dispatchEvent(new Event('input'));
});
</script>

{% endblock %}
