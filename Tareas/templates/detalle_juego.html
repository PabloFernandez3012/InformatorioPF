<!-- 
=============================================================================
TEMPLATE DE DETALLE DE JUEGO
=============================================================================
Esta p√°gina muestra informaci√≥n detallada de un juego espec√≠fico,
incluyendo todas sus rese√±as y la opci√≥n de escribir una nueva rese√±a.
-->

{% extends 'base.html' %} <!-- Hereda la estructura de base.html -->

<!-- T√≠tulo espec√≠fico de esta p√°gina -->
{% block title %}{{ juego.nombre }} - Juegos - Proyecto Django{% endblock %}

<!-- Breadcrumb espec√≠fico -->
{% block breadcrumb %}
    üè† <a href="{% url 'home' %}" style="color: #6c757d; text-decoration: none;">Inicio</a> 
    <span style="margin: 0 8px;">‚Ä∫</span> 
    üéÆ <a href="{% url 'tareas' %}" style="color: #6c757d; text-decoration: none;">Juegos</a>
    <span style="margin: 0 8px;">‚Ä∫</span> 
    <strong style="color: #007bff;">üéØ {{ juego.nombre }}</strong>
{% endblock %}

{% block content %}

<!-- 
=============================================================================
INFORMACI√ìN PRINCIPAL DEL JUEGO
=============================================================================
Las variables 'juego', 'resenas' y 'usuario_ya_reseno' vienen de la vista
detalle_juego() en views.py
-->

<!-- ===== T√çTULO DEL JUEGO ===== -->
<h1>{{ juego.nombre }}</h1>

<!-- ===== INFORMACI√ìN DETALLADA DEL JUEGO ===== -->
<div style="margin-bottom: 20px;">
    <!-- Estudio desarrollador -->
    <p><strong>Estudio:</strong> {{ juego.estudio }}</p>
    
    <!-- 
    =============================================================================
    CATEGOR√çAS DEL JUEGO EN DETALLE
    =============================================================================
    Muestra las categor√≠as con un dise√±o m√°s detallado
    -->
    {% if juego.categorias.all %}
        <div style="margin: 15px 0;">
            <p style="margin-bottom: 8px;"><strong>Categor√≠as:</strong></p>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                {% for categoria in juego.categorias.all %}
                    <span style="background: linear-gradient(45deg, #007bff, #0056b3); color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500; box-shadow: 0 2px 4px rgba(0,123,255,0.3);">
                        {{ categoria.get_nombre_display }}
                    </span>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p style="color: #6c757d; font-style: italic; margin: 15px 0;">Este juego no tiene categor√≠as asignadas</p>
    {% endif %}
    
    <!-- Fecha de publicaci√≥n original del juego -->
    <p><strong>Fecha de publicaci√≥n:</strong> {{ juego.fecha_publicacion|date:"d/m/Y" }}</p>
    
    <!-- 
    =============================================================================
    PUNTUACI√ìN PROMEDIO EN DETALLE
    =============================================================================
    Muestra informaci√≥n detallada sobre las puntuaciones
    -->
    {% if juego.numero_resenas > 0 %}
        <div style="background-color: #e7f3ff; padding: 15px; border-left: 4px solid #007bff; margin: 15px 0;">
            <h4 style="margin: 0 0 10px 0; color: #007bff;">Puntuaci√≥n de los usuarios</h4>
            <div style="font-size: 18px;">
                <strong>{{ juego.estrellas_promedio_visual }}</strong>
            </div>
            <small style="color: #6c757d;">
                Basado en {{ juego.numero_resenas }} rese√±a{{ juego.numero_resenas|pluralize:"s" }}
            </small>
        </div>
    {% else %}
        <div style="background-color: #f8f9fa; padding: 15px; border-left: 4px solid #6c757d; margin: 15px 0;">
            <em style="color: #6c757d;">Este juego a√∫n no tiene rese√±as</em>
        </div>
    {% endif %}
    
    <!-- Descripci√≥n completa del juego -->
    <p><strong>Descripci√≥n:</strong> {{ juego.descripcion }}</p>
    
    <!-- Fecha cuando se agreg√≥ al sistema -->
    <small>Agregado: {{ juego.creado|date:"d/m/Y" }}</small>
</div>

<!-- 
=============================================================================
SECCI√ìN DE CREAR RESE√ëA (SOLO PARA USUARIOS AUTENTICADOS)
=============================================================================
Esta secci√≥n cambia seg√∫n el estado de autenticaci√≥n del usuario
-->
{% if user.is_authenticated %}
    <!-- ===== USUARIO AUTENTICADO ===== -->
    {% if not usuario_ya_reseno %}
        <!-- Si el usuario NO ha hecho una rese√±a, mostrar bot√≥n para crear -->
        <div style="margin-top: 20px;">
            <!-- Enlace que lleva al formulario de crear rese√±a -->
            <a href="{% url 'crear_resena' juego.id %}" 
               style="background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;">
               Escribir Rese√±a
            </a>
        </div>
    {% else %}
        <!-- Si el usuario YA hizo una rese√±a, mostrar mensaje confirmatorio -->
        <p style="color: green; margin-top: 10px;">‚úì Ya has escrito una rese√±a para este juego</p>
    {% endif %}
{% else %}
    <!-- ===== USUARIO NO AUTENTICADO ===== -->
    <!-- Invitar al usuario a iniciar sesi√≥n para poder rese√±ar -->
    <p style="margin-top: 10px;">
        <a href="{% url 'entrar' %}">Inicia sesi√≥n</a> para escribir una rese√±a
    </p>
{% endif %}

<!-- 
=============================================================================
SECCI√ìN DE RESE√ëAS EXISTENTES
=============================================================================
Muestra todas las rese√±as que otros usuarios han hecho de este juego
-->

<!-- ===== T√çTULO DE LA SECCI√ìN DE RESE√ëAS ===== -->
<!-- {{ resenas.count }} cuenta autom√°ticamente el n√∫mero de rese√±as -->
<h3 style="margin-top: 30px;">Rese√±as ({{ resenas.count }})</h3>

<!-- ===== VERIFICAR SI EXISTEN RESE√ëAS ===== -->
{% if resenas %}
    <!-- ===== BUCLE PARA MOSTRAR CADA RESE√ëA ===== -->
    {% for resena in resenas %}
        <div style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px;">
            <!-- Header de la rese√±a: usuario y puntuaci√≥n -->
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <!-- Nombre del usuario que escribi√≥ la rese√±a -->
                <strong>{{ resena.usuario.username }}</strong>
                
                <!-- 
                =============================================================================
                SISTEMA DE ESTRELLAS PARA PUNTUACI√ìN
                =============================================================================
                Este bucle genera estrellas seg√∫n la puntuaci√≥n (1-5)
                "12345" es una cadena de 5 caracteres para iterar 5 veces
                -->
                <div>
                    {% for i in "12345" %}
                        <!-- Si el n√∫mero del bucle es <= puntuaci√≥n, mostrar estrella llena -->
                        {% if forloop.counter <= resena.puntuacion %}
                            ‚≠ê
                        {% else %}
                            <!-- Si no, mostrar estrella vac√≠a -->
                            ‚òÜ
                        {% endif %}
                    {% endfor %}
                    <!-- Mostrar tambi√©n la puntuaci√≥n num√©rica -->
                    ({{ resena.puntuacion }}/5)
                </div>
            </div>
            
            <!-- ===== CONTENIDO DE LA RESE√ëA ===== -->
            <!-- Comentario escrito por el usuario -->
            <p style="margin: 10px 0;">{{ resena.comentario }}</p>
            
            <!-- Fecha y hora cuando se escribi√≥ la rese√±a -->
            <!-- |date:"d/m/Y H:i" formatea fecha y hora -->
            <small style="color: #666;">{{ resena.fecha_creacion|date:"d/m/Y H:i" }}</small>
        </div>
    {% endfor %}
{% else %}
    <!-- ===== MENSAJE CUANDO NO HAY RESE√ëAS ===== -->
    <p>No hay rese√±as para este juego a√∫n.</p>
{% endif %}

<!-- ===== ENLACE PARA VOLVER A LA LISTA ===== -->
<!-- Bot√≥n para regresar a la lista de juegos -->
<a href="{% url 'tareas' %}" style="margin-top: 20px; display: inline-block;">‚Üê Volver a Juegos</a>

{% endblock %}
